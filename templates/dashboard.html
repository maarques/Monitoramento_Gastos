{% extends "base.html" %}
{% block title %}Dashboard - {{ file or '' }}{% endblock %}

{% block content %}

  <div class="file-title-container">
    <h3>Arquivo Aberto: <span>{{ file or "(nenhum)" }}</span></h3>
  </div>

  <section class="box">
    <h2>Adicionar novo lançamento</h2>

    <div class="add-form">
      <div class="form-group category-group">
        <label for="select-category">Categoria</label>
        <div class="category-selector">
          <select id="select-category">
            {% for c in categories %}
              <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
            <option value="_new_">+ nova categoria...</option>
          </select>
          <input type="text" id="new-category-name" placeholder="Nome da nova categoria" style="display:none;">
        </div>
      </div>

      <div class="form-group description">
        <label for="f-nome">Descrição</label>
        <input id="f-nome" type="text" placeholder="Ex: Conta de luz">
      </div>

      <div class="form-group value">
        <label for="f-valor">Valor (R$)</label>
        <input id="f-valor" type="number" placeholder="Ex: 120.50">
      </div>

      <div class="form-group date">
        <label for="f-data">Data</label>
        <input id="f-data" type="date">
      </div>

      <div class="form-group obs">
        <label for="f-obs">Observações</label>
        <input id="f-obs" type="text" placeholder="Algum detalhe extra">
      </div>

      <div class="form-group paid">
        <label for="f-pago">
          <input id="f-pago" type="checkbox">
          Pago
        </label>
      </div>

      <div class="form-group action-group">
        <button id="btn-add">Adicionar Lançamento</button>
      </div>
    </div>
  </section>

  <section class="box">
    <h3>Seus Lançamentos</h3>
    <div id="gastos-list" class="gastos-scroll">
      {% if data %}
        {% for category, rows in data.items() %}
          <h4 class="cat-title">{{ category }}
            <button class="btn-delete-category" data-category="{{ category }}">Excluir Categoria</button>
          </h4>
          <div class="cat-container" data-category="{{ category }}">
            {% for r in rows %}
              <div class="gasto-item" data-id="{{ r.id }}">
                <div class="gasto-row">
                  <div class="gasto-col nome" data-field="nome">{{ r.nome }}</div>
                  <div class="gasto-col valor" data-field="valor">R$ {{ "%.2f"|format(r.valor) }}</div>
                  <div class="gasto-col pago" data-field="pago"><input type="checkbox" class="chk-pago" {% if r.pago %}checked{% endif %}></div>
                  <div class="gasto-col data" data-field="data">{{ r.data or '' }}</div>
                  <div class="gasto-col obs" data-field="obs">{{ r.obs or '' }}</div>
                  <div class="gasto-col actions">
                    <button class="btn-edit">Editar</button>
                    <button class="btn-delete">Apagar</button>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endfor %}
      {% else %}
        <p>Nenhum lançamento carregado.</p>
      {% endif %}
    </div>
  </section>

  <section class="box save-section">
    <button id="btn-save">Salvar Alterações na Planilha</button>
    <span id="save-msg"></span>
  </section>

{% endblock %}